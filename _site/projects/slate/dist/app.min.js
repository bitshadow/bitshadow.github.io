!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("config/share")):"function"==typeof define&&define.amd?define(["config/share"],t):t(e.config)}(this,function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function r(){var e=["monospace","sans-serif","serif"],t="mmmmmmmmmmlli",n="72px",r=document.getElementsByTagName("body")[0],o=document.createElement("span");o.style.fontSize=n,o.innerHTML=t;var i={},a={};for(var l in e)o.style.fontFamily=e[l],r.appendChild(o),i[e[l]]=o.offsetWidth,a[e[l]]=o.offsetHeight,r.removeChild(o);var u=function(t){var n=!1;for(var l in e){o.style.fontFamily=t+","+e[l],r.appendChild(o);var u=o.offsetWidth!=i[e[l]]||o.offsetHeight!=a[e[l]];r.removeChild(o),n=n||u}return n};this.detect=u}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}var d=["#B7D438","#1C747F","#4B687C","#5CB932","#EF7409","#F3D063","#31B98E","#6AA398","#D55A29","#B32B54","#FBB30D","#621239","#315873","#C12E01","#671C41","#22A1FF","#621239","#6CC08E","#3B8187","#D3192F","#80A000","#F48200","#000C3B","#3B8187","#BE1E2D","#1A2728","#5F8964","#EA5F61","#BA4938","#185546","#4667B2","#74A187","#F10043","#EEA623","#3B5C79"],f=["The Shortest Answer Is Doing The Thing.","Don't Just Be Good To Others. Be Good To Yourself To.","Its Ok To Be Happy With A Calm Life","Stay True In Dark And Humble In Spotlight.","I DONT WANT PERFECT I WANT HONEST","Hard Days Are The Best Because That's When Champions Are Made","KEEP KALM AND LET IT GO","Whether You Think You Can Our You Can't You're Right","You know What's One Wrong Thing We Do When We Fall In Love?   WE EXPECT â˜¹ ","NOT TO SPOIL THE ENDING FOR YOU, BUT EVERYTHING IS GOING TO BE    OK ","TRUST ME YOU CAN DANCE    -VODKA"],p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=Backbone,v=g.Model,y=function(e){var r=function(){t(this,r),null!=e&&e.apply(this,arguments)};return n(r,e),p(r,[{key:"defaults",value:function(){var e=d[Math.floor(Math.random()*d.length)],t=f[Math.floor(Math.random()*f.length)];return{bgColor:e,textColor:"#fff",family:"Georgia",text:t,width:360,height:400,fontHeight:35,delay:300}}}]),r}(v),m=y,w=["Andale Mono","Arial Black","Arial Narrow","Arial Rounded MT Bold","Arial","Avant Garde","Baskerville","Big Caslon","Bodoni MT","Book Antiqua","Brush Script MT","Calibri","Calisto MT","Cambria","Candara","Century Gothic","Consolas","Copperplate","Courier New","Didot","Franklin Gothic Medium","Futura","Garamond","Geneva","Georgia","Gill Sans","Goudy Old Style","Helvetica","Hoefler Text","Impact","Lucida Bright","Lucida Console","Lucida Grande","Lucida Sans Typewriter","Monaco","Optima","Palatino","Papyrus","Perpetua","Rockwell Extra Bold","Rockwell","Segoe UI","Tahoma","Times New Roman","Trebuchet MS","Verdana"],b=new r,C=[];w.forEach(function(e){b.detect(e)&&C.push(e)});var T=C,O=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),k=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:SlateConfigView__get(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},x=Backbone,B=x.View,E=function(e){var t=function(e){o(this,t),_.defaults(e,{events:{"change .text-color":"_updateModel","change .bg-color":"_updateModel","keyup .text":"setText","change .family":"_updateModel","keyup .delay":"_updateModel","keyup .font-height":"_updateModel","keydown .delay":"_updateInput","keydown .font-height":"_updateInput"}}),k(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.fonts=T,this.template=_.template($("script.slate-config").html())};return i(t,e),O(t,[{key:"initialize",value:function(){this._setDebouncedText=_.debounce(_.bind(this.setDebouncedText,this),300)}},{key:"render",value:function(){this.$el.append(this.template({model:this.model.attributes})),this.postRender()}},{key:"postRender",value:function(){var e=this,t=this.$(".family"),n="";this.fonts.forEach(function(t){var r=t.name===e.model.get("family")?"selected":"";n+='<option val="'+t+'"'+r+">"+t+"</option>"}),t.append(n);var r=["bgColor","textColor","text"];r.forEach(function(t){e.$('[name="'+t+'"]').val(e.model.get(t))})}},{key:"setDebouncedText",value:function(e){this.model.set({text:e})}},{key:"setText",value:function(e){var t=$(e.target).val();this._setDebouncedText(t)}},{key:"_updateInput",value:function(e){if(38==e.keyCode||40==e.keyCode){var t=$(e.currentTarget),n=parseInt(t.val()),r=38==e.keyCode?1:-1,o=e.shiftKey?10:1,i=n+r*o;0>i&&(i=0),t.val(i)}}},{key:"_updateModel",value:function(e){var t=$(e.currentTarget),n=t.val(),r=void 0;r=t.attr("name"),("fontHeight"===r||"delay"===r)&&(n=parseInt(n,10)),("textColor"===r||"bgColor"===r)&&(n="#"+n),this.model.set(r,n)}},{key:"setAttributes",value:function(e){var t=$('[name="text"]').val();this.model.set({text:t})}}]),t}(B),S=E,A={setFont:function(e){var t=this.fontHeight*this.scale+"px";e.font=t+"/"+t+" "+this.family},createDummy:function(){var e=document.createElement("canvas");return e.width=this.width*this.scale,e.height=this.height*this.scale,e.getContext("2d")},drawBackground:function(e){var t=e.canvas.width,n=e.canvas.height;e.fillStyle=this.bgColor,e.fillRect(0,0,t,n)},drawText:function(e,t){var n=e.canvas.width/2,r=e.canvas.height/2;e.textAlign="center",e.textBaseline="middle",e.fillStyle=this.textColor,e.fillText(t,n,r)},drawDummy:function(e,t){var n=e.canvas.width,r=e.canvas.height;e.drawImage(t.canvas,0,0,n,r)},getCanvas:function(e){var t=document.createElement("canvas");return t.width=this.width,t.height=this.height,t},setProperties:function(e){this.bgColor=e.bgColor,this.height=e.height,this.width=e.width,this.text=e.text||"",this.textColor=e.textColor,this.delay=e.delay||0,this.fontHeight=e.fontHeight||0,this.family=e.family||"Georgia, serif",this.scale=2},renderGif:function(e){var t=this,n=t.getCanvas().getContext("2d"),r=t.createDummy(),o=t.getGifCreator(e);t.setFont(r);for(var i=this.text.split(" "),a=0,l=i.length;l>a;a++)t.drawBackground(r),t.drawText(r,i[a]),t.drawDummy(n,r),o.addFrame(n,{copy:!0,delay:t.delay});t.drawBackground(r),t.drawDummy(n,r),o.addFrame(n,{delay:2*t.delay}),o.render()},getStyles:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t+=n+":"+e[n]+";");return t},getSVG:function(e){var t={display:"table-cell",width:e.canvas.width+"px",height:e.canvas.height+"px",color:this.textColor,"font-size":this.fontHeight*this.scale+"px","font-family":this.family,"vertical-align":"middle"},n=e.canvas.width-20,r={margin:"0 auto",width:n+"px","word-wrap":"break-word"},o="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='720' height='800'><foreignObject width='100%' height='100%'><div xmlns='http://www.w3.org/1999/xhtml' style='"+this.getStyles(t)+"'><div align='center' style='"+this.getStyles(r)+"'>"+this.text.trim()+"</div></div></foreignObject></svg>";return o},renderImage:function(e){var t=this,n=t.getCanvas().getContext("2d"),r=t.createDummy(),o=t.getGifCreator(e),i=(window.URL||window.webkitURL||window,new Image);i.onload=function(){t.drawBackground(r),r.drawImage(i,0,0),t.drawDummy(n,r),o.addFrame(n,{delay:0}),o.render()},i.src=this.getSVG(r)},render:function(e){this.delay>0?this.renderGif(e):this.renderImage(e)},getGifCreator:function(e){var t=this,n=new GIF({workers:2,quality:10,width:t.width,height:t.height});return n.on("finished",function(t,n){var r=btoa(String.fromCharCode.apply(null,n));e(null,r)}),n}},D=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),P=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:SlateView__get(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},j=Backbone,I=j.View,G=function(e){var t=function(e){a(this,t),P(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.listenTo(this.model,"change",this.render)};return l(t,e),D(t,[{key:"render",value:function(){A.setProperties(this.model.toJSON()),A.render(function(e,t){var n=$("#result");n.removeClass("hide"),n.attr("src","data:image/gif;base64,"+t),localStorage.dataBase64=t})}}]),t}(I),F=G,M=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),H=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:ShareView__get(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},L=Backbone,N=L.View,V=function(e){var t=function(e){u(this,t),_.defaults(e,{events:{"click .get-url":"upload"}}),H(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var n=this;n.listenTo(n.model,"change",function(){n.model.hasChanged("url")?n.render():(n.render(),n.hideLoading(),n.model.unset("url"))}),n.template=_.template($("script.share-template").html())};return s(t,e),M(t,[{key:"postRender",value:function(){var e=this.model.get("url");e&&(this.$(".url").get(0).select(),this.$(".url-btn").addClass("hide"),this.showShare(e)),this.hideLoading()}},{key:"render",value:function(){var e=this.$(".sharer"),t={model:this.model.attributes};e.html(""),e.html(this.template(t)),this.postRender()}},{key:"showShare",value:function(e){this.$(".share-btn").hideshare({link:e,media:e+".gif",position:"right",linkedin:!1,title:"Created with Slate. http://bitshadow.github.io/slate"})}},{key:"showLoading",value:function(){$(".spinner").removeClass("hide"),this.$(".url-btn").addClass("hide")}},{key:"hideLoading",value:function(){$(".spinner").addClass("hide")}},{key:"upload",value:function(){this.showLoading();var e=this,t="Client-ID f0972432933fc36";$.ajax({url:"https://api.imgur.com/3/image",type:"POST",headers:{Authorization:t,Accept:"application/json"},data:{image:localStorage.dataBase64,type:"base64"},success:function(t){var n=t.data.id;e.model.set("url","http://imgur.com/"+n),console.log("image upload with this id",n)},error:function(e){console.log(e)}})}}]),t}(N),R=V,W=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Y=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:app__get(o,t,n)}if("value"in r)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},U=Backbone,K=U.View,z=function(e){function t(e){c(this,t),Y(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var n=new m;this.slateConfigView=new S({model:n,el:$(".slate__config")}),this.slateView=new F({model:n,el:$(".slate__preview")}),this.shareView=new R({model:n,el:$(".share-box")})}return h(t,e),W(t,[{key:"render",value:function(){this.slateConfigView.render(),this.slateView.render()}}]),t}(K);(new z).render()});
